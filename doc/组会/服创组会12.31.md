# 服创组会12.31

> - [第十三届中国大学生服务外包创新创业大赛](http://www.fwwb.org.cn/)
> - [【A06】云桌面的暗水印方案](http://www.fwwb.org.cn/topic/show/199c8731-ece6-45df-bfb0-8595ddd2980c)
> - 我们的目标是**保国二、冲国一**。

[TOC]

## 时间地点

12.31 周五下午 15:00 西苑食堂二楼

## 主要目标

- 解决检测算法选型（包括具体的哪一种网络、损失函数、数据集构造）
- 讨论失真变换详细（包括内容、顺序、实现）
- 确认总结报告（由 hch 在会前完成，并在会时补充，最后在结束时讲述）
- 确认开发 git 相关（分支命名、使用、commit 格式）
- 确认学习方向，有什么学习方向、实现方法不清楚的话，就讨论一下

## 组会内容详细

### ==主干逻辑分支==

- 截取部分：
  - 将保持分辨率的截图用黑色填充为解码尺寸，进行解码
  - 处理截取图片并跑 n 次模型：
    - 缩放 side:50~400 stride:5
    - 旋转 angle:0~360 stride:10
      - 基于内容（文本框）检测的旋转
- 拍摄整体：
  - 检测目标的选择
    - 隐写图片（要融合在编码-解码训练中）
      - 好处：普适性强，反向传播时可以选择让detector指导encoder编码
      - 坏处：不一定能成功，训练花销大
    - 屏幕、白纸上的打印图片
      - 好处：针对性强，与编码解码过程解耦
      - 坏处：要训练多个模型，需要自己寻找创建数据集
  - 检测模式的选择
    - 检测四个关键点
      - 好处：比较简单
      - 坏处：检测效率不一定能够保证
    - 分割目标区域
      - 好处：鲁棒性可能更好
      - 换出：需要额外通过分割区域的凹凸点来拟合四个关键点
    - 传统cv
      - 好处：实现简单，可以帮助自动生成上述模型使用的数据集label
      - 坏处：鲁棒性差，局限性大
  - 检测模型是可选的
    - 检测模型预测出四个关键点
      - 目的：通过视频体现解码效果
    - 手动标定四个点
      - 更加准确
      - 应用场景中完全可以要求手动标定来获取需要溯源的泄密图片
  - 通过四个关键点将预测区域透视变换成400*400的输入（decoder）的图片

### 隐写失真逻辑

- 失真扰乱的顺序？
  2. 反光
     - 计算图流通
     - 权重
     - 位置
  3. 影子（局部变暗）
  4. 随机遮挡（散块遮挡，实现上要修改随机遮挡的逻辑）

  当前的变换

  1. 第一次空间变换——模拟相机与屏幕的视角差
  2. 亮度、对比度、饱和度、色调——模拟不同相机的成像差异
  3. 模糊——模拟运动模糊
     - 需要实现随机方向的运动模糊
  4. jpeg压缩——模拟图片保存
  5. 随机噪声——模拟成像噪声
  6. 第二次空间变换——模拟检测器的结果，尽可能是标准解码输入
     - 需要重新修改4个点的选取方式，要实现边缘信息的丢失

- 失真扰乱的递增策略？

  - （简略说，可以在后续实验中调整）

- 随机遮挡也许可以暂且当做局部识别？

  - 一方面实现随机遮挡并当做局部识别；一方面实现真正的局部识别，但需要做一个新的逻辑，可能的话需要和前面的逻辑进行融合

### 检测部分详细（由sjh调研后主讲）

<img src="服创组会12.13/image-20211208224809006.png" alt="image-20211208224809006" style="zoom: 150%;" />

- 算法类型？分割 or 关键点？
  - 分割
- 检测目标？暗水印 or 屏幕+打印 or 一个广义的矩形图片？
  - 图片
- 如果是暗水印，那么上面的流程有问题吗？
- 有必要训练 detector 吗？如果评委批评检测，该如何回答？
  - 已经专门提供了手动标定四个点的接口
- 数据集的来源？屏幕、打印图片？
  - 
- 如何调整代码结构与隐写模块结合？
- 检测的反向传播会对encoder造成影响，detach是否会有训练失败的风险？
- 时间花费预估、风险如何补救？
- 具体的算法模型介绍，数据集构造流程？

### 调用接口约定

- 需求：
  - 需要有接口进行训练
  - 需要有接口推理
    - 局部的图片的解码
    - 整体的图片的解码
      - 整体拍照的图片+检测模式 -> 四个关键点
      - 四个点+整体的图片 -> decoder的输入图片
      - decoder输入图片 -> id+time

```python
- detection
	- 
- service
	- flask?             # 调用 tool.encode
- steganography
	- ...
    - train.py           # 训练？
- tool                   # 整合各模块的接口，应该是作为解耦业务的一层
	- utils		         # 可能用到单不属于各个模块的工具
    	- bch_utils.py   # bch 不会在其他模块直接使用
        - mask2point.py  # 由 mask 拟合四个关键点
    - decode.py          # 对单张隐写图片解码
    - encode.py          # 对单张图片进行编码
    - detect.py          # 检测关键点
- exsample.py            # 调用各个接口的展示？
```

- 看时间能解耦就解耦，不行就算了（
- 可以在各自开发的时候自己写文档，跟组内对齐进度吧

### 服务逻辑详细

- 首先需要有一台能连外网的服务器？
- 压力测试？
- 以什么标准来确定是否需要进模型？
  - 是否进行操作/两帧图像差值过大

### 开发相关约定

- 分支名 xxx-dev？
- commit 信息格式？

### 总结项目优势、其余需要整理的资料（由hch总结）

- 相比新华三？
  - 对于复杂图片依然有良好的编码解码效果
  - 能够在拍照中检测
- 相比 StegaStamp？
  - 对损失函数进行了优化，对于高低频区域加入不同的损失权重，以此获得了感知差异性更低的编码图像
  - 对失真变换的顺序进行了研究，更加符合真实场景的因素干扰
  - 解决了论文模型无法自适应大小的问题
  - 简化了训练过程，摒弃了冗余的鉴别器（真的可以删掉（删之前push一下代码
  - 显式地在训练过程中加入遮挡，更能够帮助训练解码局部图像
  - 减少了参数量，使之更易于部署实际服务
    - 实际上原论文已经很少了，但是应该可以把最下面一层网络删掉，继续减少参数试试
      - 卷积决定运算速度，全连接决定参数量
    - 可以把 100 位长 bit 直接砍成 96bit，少 4 位也是少
    - 网络剪枝（又是一个深坑嗷
- 还有其他哪些隐写方法？
  - 
- bch 的理论检错纠错能力？

### 演讲逻辑（非重点）

- 10 min，突出重点
- 

### 视频逻辑（非重点）

- 可以分两个视频，一个作为提交的基本材料，一个作为答辩辅助材料

  - 后者可为前者的缩水版

  - > ppt、演讲稿、视频三者需要在提交 deadline 之前全部完成

- 

## 最后要说的几点

> 1. 绝对不要拖 deadline
> 2. Talk is cheap, (                 ).
> 3. No bullshit, no 摸鱼.
> 4. 可以为考研留时间，但要保证自己部分的质量。
> 5. 尽量寒假完成，但不代表拖完寒假就可以不做。

